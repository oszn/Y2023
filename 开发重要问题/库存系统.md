# 库存系统

我的库存系统做的比较复杂吧，在这里出现了非常多的问题。

记录下非常重要的点

1. 库存数据库更新过程最好是`串行化`

## 为什么串行化？

一开始我使用的消息队列是单线程消费，这个数据库更新主要是一个缓存与数据库一致性更新问题。单线程我觉得很慢，于是使用了多线程，本身数据更新语句用的是乐观锁思想，也就是会判断是否被修改过。我修改了，消息队列消费方式，使用了多线程工厂消费，结果就出现大量的CAS失败，自旋了很多次都没消费成功，导致数据库更新直接炸。所以对于单机来说，可以+sychronized或者直接单线程更新数据库，如果觉得还是慢，只能说把消息队列按照商品的id路由到指定的消息队列进行消费。

对于多线程出现的问题，我目前没有更好的解决方案，感觉对于分布式的环境来说，也是非常难同步的过程。

